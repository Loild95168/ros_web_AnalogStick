<!DOCTYPE html>
<html>
<head>
  <title>æ§åˆ¶ ROS ç„¡äººè»Š</title>
</head>
<body>
  <h2>é ç«¯æ§åˆ¶</h2>

  <div id="time" style="font-size: 18px; margin-bottom: 10px;"></div>
  <div id="latency" style="font-size: 16px; color: green; margin-bottom: 10px;"></div>

  <button onclick="send('forward')">å‰é€²</button>
  <button onclick="send('back')">å¾Œé€€</button>
  <button onclick="send('stop')">åœæ­¢</button>

  <script>
    function updateTime() {
      const now = new Date();
      const formatted = now.toLocaleString();
      document.getElementById('time').innerText = "ç¾åœ¨æ™‚é–“ï¼š" + formatted;
    }

    setInterval(updateTime, 1000);
    updateTime();

    function send(cmd) {
      const t0 = performance.now();
      const client_time = new Date().toISOString();

      fetch('https://ros-web-control.onrender.com/control', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          command: cmd,
          client_time: client_time
        })
      })
      .then(res => res.json())
      .then(data => {
        const t1 = performance.now();
        const latency = Math.round(t1 - t0);

        let info = `ğŸ“¡ å‚³è¼¸å»¶é²ï¼ˆclientï¼‰ï¼š${latency} ms`;
        if (data.delay_ms !== null) {
          info += `\nâ± æŒ‡ä»¤å»¶é²ï¼ˆserver è¨ˆç®—ï¼‰ï¼š${data.delay_ms} ms`;
        }
        if (data.server_time_taiwan) {
          info += `\nğŸ•’ ä¼ºæœå™¨æ™‚é–“ï¼ˆå°ç£ï¼‰ï¼š${data.server_time_taiwan}`;
        }

        document.getElementById('latency').innerText = info;
        alert("âœ… å·²é€å‡ºæŒ‡ä»¤ï¼š" + cmd);
      });
    }
  </script>
</body>
</html>
